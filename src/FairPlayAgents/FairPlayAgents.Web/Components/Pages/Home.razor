@page "/"
@using Azure.AI.OpenAI
@using Azure.Identity
@using Microsoft.Agents.AI
@using ModelContextProtocol.Client
@using Microsoft.Extensions.AI
@using OpenAI
@using System.Threading
@using System.Linq
@using System.Collections.Generic
@using System
@using System.Net.Http


@rendermode RenderMode.InteractiveServer

<PageTitle>Home</PageTitle>

<div class="mt-4">
    <h3>Ask the Agent</h3>
    <div class="mb-2">
        <label for="agentRequest">Request to agent</label>
        <input id="agentRequest" @bind="agentRequest" class="form-control" />
    </div>
    @if (!string.IsNullOrEmpty(agentResult))
    {
        <div class="alert alert-info">@agentResult</div>
    }
    @if (!string.IsNullOrEmpty(agentError))
    {
        <div class="alert alert-danger">@agentError</div>
    }
</div>

<button type="button" @onclick="@(async () => await SendRequestAsync())">Send request</button>

@code {
    [Inject(Key = "VideoAgent")]
    public AIAgent? videoAgent { get; set; }
    private string agentRequest = string.Empty;
    private bool isCalling = false;
    private string? agentResult;
    private string? agentError;

    // Convenience test that sends an upload request to the server agent (which can invoke upload tool/server function)
    private async Task SendRequestAsync()
    {
        try
        {
            var response = await videoAgent!.RunAsync(agentRequest);
            agentResult = response.Text;
        }
        catch (Exception ex)
        {
            agentError = ex.Message;
        }
    }
}